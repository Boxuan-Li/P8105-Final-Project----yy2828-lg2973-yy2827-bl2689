---
title: "Why is a TED Talk Popular?"
author: "Lu Gan_lg2973, Yangwei Yan_yy2828, Yunqiu Yao_2827, Boxuan Li_bl2689"
output: 
  html_document:
    code_folding: hide
---

```{r, include=FALSE}
knitr::opts_chunk$set(
  collapse = FALSE,
  fig.width = 8,
  fig.asp = .6,
  out.width = "90%"
)

library(tidyverse)
library(janitor)
library(ggthemes)
library(ggridges)
library(stringr)
library(forcats)
library(tidytext)
library(viridis)
library(anytime)
library(wordcloud)

theme_set(theme_bw())
theme_update(legend.position = "bottom")
```

```{r Read and clean, message=FALSE, echo=FALSE, warning=FALSE}
ted.data <- read_csv("./data/TED.csv")

head(ted.data,10)

## Add the column of no.
ted <- read_csv("./data/TED.csv") %>%
  clean_names() %>%
  mutate(no = row_number()) %>% 
  select(no, everything(), -event, -film_date, -related_talks, -name)

## Tidy the "published_date" variable. 
## Convert UNIX timestamps into regular date form.
ted = ted %>%
  mutate(published_date = anydate(published_date)) %>%
  separate(published_date, into = c("year", "month", "day"), sep = "-")
```

### Introduction

TED (Technology, Entertainment, Design) is an organization that posts talks online for free dissemination. TED was founded in 1984 as a conference and has developed a lot so far. And nowadays, it has become the symbol of idea gathering, rooted into our life everywhere around. Even though one barely hears of the TED talk, its famous slogan of "ideas worth spreading" and the typical starry sky at the start of each talk should be probably noticed. It is always inspiring to enjoy a TED talk after work or study in our daily life and every fan of TED talk must have his or her own evaluation criteria to rate TED talks with multifarious topics. Hence, these talks, full of wisdom, gain abundant reviews and comments from viewers, which can serve as implication of both popularity of the talks and those viewers' interests.

Members in our group have always been fascinated by TED talks and the marvelous diversity of the contents. We tend to focus on topics that we are interested in and share our thoughts about it. An idea therefore came to our mind that we can try to explore what exactly affects the popularity of a particular TED talk by combining the skills out of the data science course and some strategies to operate the data obtained. 

In this study, the collected dataset that covers the overall information about `r dim(ted.data)[1]` TED talks, hosted on the official TED.com website from June 26th, 2006 to September 21st, 2017. In this dataset, there are `r dim(ted.data)[2]` variables, including number of views, number of comments, description of each talk, etc. Key variables are summarized as follows,

* name : The official name of the TED Talk. Includes the title and the speaker;
* title : The title of the talk;
* description : A blurb of what the talk is about;
* main_speaker : The first named speaker of the talk;
* speaker_occupation : The occupation of the main speaker;
* num_speaker : The number of speakers in the talk;
* duration : The duration of the talk in seconds;
* event : The TED/TEDx event where the talk took place;
* film_date : The Unix timestamp of the filming;
* published_date : The Unix timestamp for the publication of the talk on TED.com;
* comments : The number of first level comments made on the talk;
* tags : The themes associated with the talk;
* languages : The number of languages in which the talk is available;
* ratings : A stringified dictionary of the various ratings given to the talk (inspiring, fascinating, jaw dropping, etc.);
* related_talks : A list of dictionaries of recommended talks to watch next;
* url : The URL of the talk;
* views : The number of views on the talk.

Based on the dataset, there are some points expected to be explored in this study. Firstly, this report will include basic description and operation of several remarkable variables among all 17. For instance, in the "tag" varibale, information about the topic (or theme) of that talk can be extracted, which can lay a foundation for further investigation of the association between the topic and popularity of a talk. In addition, the development of TED over time is anticipated to be presented by this means. Secondly, this report will review the connection of the popularity of a TED talk with other varibales. What makes a TED talk popular is the main focus in this study.


### Methods

In this study, we follow a step-by-step analysis to reveal the association between the popularity and other variables. And the popularity of one TED talk is represented by the number of views ("views" variable).

1) Topic (or theme) of a TED talk is the first variable whose association with popularity will be evalueated since mostly viewers may prefer the TED talks with topics that they like. In this case, the topic of each TED talk can be extracted primarily from the "tag" variable for each TED talk. Furthermore, the topic of each TED talk can be summarized. In terms of those TED talks with multiple tagged topics, all topics are kept since it is realistic that one talk can be classified into various themes. At last, the most frequently appeared topics are ranked out with tables and figures made to show the top 10 topics with the most talks.

2)





### Results and Analysis
1) The association between __Topic__ and __Popularity___.

```{r}
## Tidy the "tags" variable.
ted_topic = ted %>%
  select(no, tags, views, year, month, day) %>%
  separate(tags, into = "")
  unnest_tokens(word, tags) %>%
  rename(topic = word)

## How many videos for each topic
n_topic = ted_topic %>% 
  group_by(topic) %>%
  count() %>%
  arrange(desc(n)) %>%
  ungroup

## filter top 10 topics with the most videos 
top10_topic = head(n_topic, 10)
knitr::kable(top10_topic, align = "c")
## Visualize the result
top10_topic %>%
  mutate(topic = fct_reorder(topic, n)) %>%
  ggplot(aes(x = topic, y = n, fill = topic)) +
    geom_bar(stat = "identity") +
    labs(
      x = "TED Topic",
      y = "Number of talks"
    )
```

TED includes talks on `r count(distinct(n_topic))` different topics. The figure above demonstrates the most 10 talked topics. Obviously, *Technology* is the topic with the most `r n_topic[1,2]` talks.

The TED topic cloud
```{r warning=FALSE, message=FALSE}
set.seed(1234)
wordcloud(words = n_topic$topic, 
          freq = n_topic$n, 
          min.freq = 1,
          max.words = 200, 
          random.order = FALSE, 
          rot.per = 0.35, 
          colors = brewer.pal(8, "Dark2"))
```


Also, we would like to explore the popuarity of topics. The figure below shows the the distribution of views for top 10 topics.
```{r}
## Visualize the distribution of views for top 10 topics.
ted_topic %>%
  filter(ted_topic$topic %in% top10_topic$topic) %>%
  mutate(topic = fct_reorder(topic, views)) %>%
  ggplot(aes(x = topic, y = views, fill = topic)) +
    geom_violin() +
    ylim(0, 5e+6) +
    stat_summary(fun.y = median, geom = "point", size = 2) +
    labs(
      x = "Topic",
      y = "Number of views for each video"
    )
```

We find that all the distributions of views are heavily right skewed, which indicates that some of the videos are extremely popular. 
We reordered the distributions by the median of views. Among the most talked 10 topics, culture and business had the highest median number of views. Therefore, what interests people most are talks related to culture and business.

To further explore how TED talks change over time, we plot two related figures below.

```{r}
## Visualize the number of TED topics through the years.
ted_topic %>%
  filter(ted_topic$topic %in% top10_topic$topic) %>%
  group_by(year, topic)%>%
  count() %>%
  ggplot(aes(x = year, y = n, group = topic, color = topic)) +
    geom_line() +
    labs(
      x = "Year",
      y = "Number of topics")

## Visualize TED topics views through the years.
ted_topic %>%
  filter(ted_topic$topic %in% top10_topic$topic) %>%
  ggplot(aes(x = year, y = views, fill = topic)) +
    geom_bar(stat = "identity", position = "fill") +
    labs(
      x = "Year",
      y = "Fraction")
```

The first figure above shows how many videos talking about top ten topics in each year. It seems that the topic "TEDx" are frequently used in 2012. TEDx was created in the spirit of TED's mission, "ideas worth spreading." It supports independent organizers who want to create a TED-like event in their own community. In March 2012, TED-Ed was launched, creating short video lessons aimed at educators, and April 2012 saw the debut of TED Radio Hour, a partnership that brings ideas and stories from TED Talks to public radio listeners. All of these projects may result in the increase of TEDx.
In 2016, we also see a peak in the increase of topic talking frequency. There are several global events held in 2016, including "TED 2016 Dream", which is a week-long conference about ideas, happening February 15-19, 2016, in Vancouver, BC, Canada.

The second figure above shows the fraction of views for top 10 topics through the years. We can see that culture have been viewed most in 2006 when the first six TED Talks were posted online. The topic "changes" drew more and more attention along the years.

2)

(1) Tidy the *ratings* variable
```{r}
ratings = ted %>%
  select(no, ratings) %>% 
  mutate(ratings = substring(ratings,3, nchar(ratings)-2)) %>% 
  mutate(ratings = str_split(ratings,"\\}, \\{")) %>% 
  unnest(ratings) %>% 
  mutate(rat.words = sub(".*name': '(.*?)',.*", "\\1", ratings),
         rat.words = tolower(rat.words),
         rat.cnt = as.numeric(sub(".*'count': ", "", ratings))) %>%
  select(-ratings) %>% print()
```

(2) Perform sentiment analysis
```{r}
### read the sentiment dataset from 'bing'
bing_sent = get_sentiments("bing")

#### calculate sentiment value for each observation
rat_sent = ratings %>% 
  rename(word = rat.words) %>% 
  inner_join(bing_sent, by="word") %>% 
  group_by(no,sentiment) %>% 
  summarize(sum_cnt = sum(rat.cnt)) %>% 
  ungroup() %>% 
  spread(sentiment, sum_cnt) %>% 
  mutate(sentiment = (-1) * negative + positive) %>% 
  select(-negative, -positive) %>% 
  left_join(ted) 

### perfrom sentiment analysis
rat_sent %>% 
  mutate(no = factor(no),
         no = fct_reorder(no, sentiment)) %>% 
  ggplot(aes(no, sentiment, fill=views, color=views)) +
    geom_bar(stat = "identity") +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank()) + 
    scale_fill_viridis() +
    scale_color_viridis()

### try the cube root to reduce skewness
rat_sent %>% 
  mutate(no = factor(no),
         no = fct_reorder(no, sentiment),
         cubert = ifelse(sentiment > 0, sentiment^(1/3), -(-sentiment)^(1/3))) %>% 
  ggplot(aes(no, cubert, fill=views, color=views)) +
    geom_bar(stat = "identity") +
    theme(axis.title.x = element_blank(),
          axis.text.x = element_blank(),
          axis.ticks.x = element_blank()) + 
    ylab("cube root of sentiment") +
    scale_fill_viridis() +
    scale_color_viridis()
```

Here in the sentiment analysis, first we extract the sentiment words and the corresponding counts that are nested in the variable *ratings* for each observation, and assign them to two new variables *rat.words* and *rat.cnt*. Then we match the rating words (*rat.words*) with the sentiments dataset from 'bing', defining the rat.words as 'positive' or 'negative'. For each inspection number(*no*), we calculate the difference of sum of positive count and sum of negative count and use it as the sentiment score for this observation. 

After obtaining the sentiment score, we start to make a plot showing the inspection sentiments and the number of viewers. We first coerce the *no* variable to factor and reorder it accorrding to the sentiment score and plot the realtionship between inspection number and sentiment score. However, since there are some observations with extremely large score, making the graph rather skewed, we try the cube root of the outcome (*sentiment*) and plot again to obtain the second graph. It can be seen that most of the ted talks have positive sentiment ratings, since only a small portion on the plot is in the negative side of y axis. Further, we find out that those ted talks with large number of viewers also receive high ratings, since the color yellow and green, which indicate a higher viewers, mostly appear at the right side of the plot, where the sentiment scores are high.

(3) Compare top 10 talks picked by viewers and ratings respectively
```{r}
top10_sent = rat_sent %>% 
  arrange(desc(sentiment)) %>% 
  head(10) %>% print()

top10_view = ted %>%
  arrange(desc(views)) %>% 
  head(10) %>% print()

```

### Tidy the *speaker_occupation* variable
```{r, warning = FALSE}
speaker = ted %>% 
  separate(speaker_occupation, into = c("speaker_occupation", "remove"), sep = "/") %>% 
  separate(speaker_occupation, into = c("speaker_occupation", "remove1"), sep = ",") %>% 
  separate(speaker_occupation, into = c("speaker_occupation", "remove2"), sep = ";") %>% 
  select(-remove, -remove1, -remove2) %>% 
  mutate(speaker_occupation = str_to_lower(speaker_occupation)) %>% 
  mutate(speaker_occupation = str_replace(speaker_occupation, "author", "writer"))

```
We know from the dataset that in speaker_occupation variable, one speaker might have more than one occupation. We also find that the first occupation is the main occupation of the speaker which can best represents their main focus, so we clean the speaker_occupation variablt to leave only the first occupation in the data set. Also, we discover that there exists writer and author in this variable and they represent the same occupation, so we replace the author with writer.

### Find out the top ten speaker occupation
```{r}
speaker %>% 
  group_by(speaker_occupation) %>% 
  summarize(n = n()) %>% 
  arrange(desc(n)) %>% 
  head(10) %>% 
  pander::pander()
```

From the above table, we find out that the most popular speaker occupation is writer, and totally 107 writers came and gave TED Talks. Then comes to artist and designer, journalist, entrepreneur, inventor, architect, psychologist, neuroscientist and physicist. We are surprised to find out that the top four occupations are all about arts, indicating that people who work with arts are more willing to give a TED Talk and their talks might attract more viewers.

### Analysis on the distribution of viewer number in top ten speaker occupation
```{r}
speaker %>% 
  filter(speaker_occupation %in% c("writer", "artist", "designer", "journalist", "entrepreneur", "inventor", "architect", "psychologist", "neuroscientist", "physicist")) %>% 
  group_by(speaker_occupation) %>% 
  ggplot(aes(x = speaker_occupation, y = views)) +
  geom_boxplot(aes(fill = speaker_occupation), alpha = .9) +
  ylim(0,7.5e+06) +
  labs(
    title = "The distribution of viewers in ten most popular speaker occupation",
    x = "speaker occupation",
    y = "views"
  )
```

Since there are several extreme points in this polt making the plots too compacted and hard to observe the distribution of each speaker occupation, we limit the range of y axis to make the plot more explicit. From the resulted boxplot, we find that physicist has the lowest median while psychologist has the highest median, indicating that TED Talks given by physicist are more popular and attract more viewers than TED Talks given by others. We also find that each occupation has some extreme points. This is easy to understand because these talks may be given by the most famous people in that area or the topic is most focus of attention.  

### Conclusion
